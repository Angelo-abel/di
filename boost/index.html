<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">

<meta name="author" content="Kris Jusiak">
<link rel="canonical" href="http://boost-experimental.github.io/di/index.html">
<title>[Boost].DI</title>

<link href="./css/boostbook.css" rel="stylesheet">
<link href="./css/github.css" rel="stylesheet">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">

<div width="100%">
<a href="http://www.boost.org/"><img alt="Boost C++ Libraries" width="277" height="86" src="./images/boost.png"></a>
</div>

<hr>
<div class="spirit-nav">
<a accesskey="p"  ><img src="./images/prev.png" alt="Prev"></a><a accesskey="u" href="index.html"><img src="./images/up.png" alt="Up"></a><a accesskey="h" href="index.html"><img src="./images/home.png" alt="Home"></a><a accesskey="n"  href="overview/index.html"><img src="./images/next.png" alt="Next"></a>
</div>

<div class="chapter">


<div class="chapter">
<div class="titlepage"><div>
<div><h2 class="title">
<a></a>[Boost].DI</h2></div>
<div><div class="author"><h3 class="author">
Kris Jusiak
</h3></div></div>
<div><p class="copyright">Copyright &copy; 2012-2018 Kris Jusiak (kris at jusiak net)</p></div>
<div><div class="legalnotice">
<a name="idm45555445986288"></a><p>Distributed under the Boost Software License, Version 1.0.
      (See accompanying file <code class="filename">LICENSE_1_0.txt</code> or copy at
      <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></div>
</div></div>

<div class="toc">
<p><b>Table of Contents</b></p>
<dl class="toc">

    
        <dt><span class="section"><a href="index.html">Introduction</a></span></dt>
    

    
        <dt><span class="section"><a href="overview/index.html">Overview</a></span></dt>
    

    
        <dt><span class="section"><a href="tutorial/index.html">Tutorial</a></span></dt>
    

    
        <dt><span class="section"><a href="try_it/index.html">Try It Online!</a></span></dt>
    

    
        <dt><span class="section"><a href="benchmarks/index.html">Benchmarks</a></span></dt>
    

    
        <dt><span class="section"><a href="user_guide/index.html">User Guide</a></span></dt>
    

    
        <dt><span class="section"><a href="examples/index.html">Examples</a></span></dt>
    

    
        <dt><span class="section"><a href="extensions/index.html">Extensions</a></span></dt>
    

    
        <dt><span class="section"><a href="FAQ/index.html">FAQ</a></span></dt>
    

    
        <dt><span class="section"><a href="CHANGELOG/index.html">CHANGELOG</a></span></dt>
    

</dl>
</div>



<div class="section">
<p><a href="http://www.boost.org/LICENSE_1_0.txt" target="_blank"><img alt="Boost Licence" src="http://img.shields.io/badge/license-boost-blue.svg" /></a>
<a href="https://github.com/boost-experimental/di/releases" target="_blank"><img alt="Version" src="https://badge.fury.io/gh/boost-experimental%2Fdi.svg" /></a>
<a href="https://travis-ci.org/boost-experimental/di" target="_blank"><img alt="Build Status" src="https://img.shields.io/travis/boost-experimental/di/cpp14.svg?label=linux/osx" /></a>
<a href="https://ci.appveyor.com/project/krzysztof-jusiak/di" target="_blank"><img alt="Build Status" src="https://img.shields.io/appveyor/ci/krzysztof-jusiak/di/cpp14.svg?label=windows" /></a>
<a href="https://codecov.io/gh/boost-experimental/di" target="_blank"><img alt="Coveralls" src="https://codecov.io/gh/boost-experimental/di/branch/cpp14/graph/badge.svg" /></a>
<a href="http://github.com/boost-experimental/di/issues" target="_blank"><img alt="Github Issues" src="https://img.shields.io/github/issues/boost-experimental/di.svg" /></a></p>
<hr />
<h1 id="introduction">Introduction</h1>
<table>
<thead>
<tr>
<th><strong>[Boost].DI</strong></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Your C++14 header only Dependency Injection library with no dependencies (<a href="http://boost-experimental.github.io/di/try_it/index.html"><strong>Try it online!</strong></a>)</td>
<td><a class="github-button" href="https://github.com/boost-experimental/di" data-style="mega" data-count-href="/boost-experimental/di/stargazers" data-count-api="/repos/boost-experimental/di#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star boost-experimental/di on GitHub">GitHub</a></td>
</tr>
</tbody>
</table>
<div class="important">
<h3 class="wy-text-neutral"><span class="fa fa-info-circle wy-text-info"></span>&nbsp; Latest Release: <b>v1.1.0</b> (Jan 7, 2019)</h3>
<a href="../releases" class="btn btn-success" style="margin-bottom:8px;" role="button"><span class="fa fa-download"></span>&nbsp; <b>Download</b></a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="CHANGELOG/index.html" class="btn btn-info" style="margin-bottom:8px;" role="button"><span class="fa fa-reorder"></span>&nbsp; <b>Changelog</b></a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="tutorial/index.html" class="btn btn-warning" style="margin-bottom:8px;" role="button"><span class="fa fa-gear"></span>&nbsp; <b>Tutorial</b></a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="examples/index.html" class="btn btn-danger" style="margin-bottom:8px;" role="button"><span class="fa fa-book"></span>&nbsp; <b>Examples</b></a>
</div>

<h1 id="what-is-dependency-injection">What is Dependency Injection?</h1>
<blockquote>
<p>"Don't call us, we'll call you", Hollywood principle</p>
</blockquote>
<p><strong><a href="http://www.youtube.com/watch?v=IKD2-MAkXyQ">Dependency Injection</a> (DI)</strong> involves passing (injecting) one or more dependencies (or services) to a dependent object (or client) which become part of the clientâ€™s state.
It is like the Strategy Pattern, except the strategy is set once, at construction. DI enables loosely coupled designs, which are easier to maintain and test.</p>
<p><center>
In short, DI is all about construction!</p>
<blockquote>
<p><strong>"Let's make some coffee!"</strong></p>
</blockquote>
<p><a href="./images/coffee_maker.png"><img alt="Coffee Maker" src="./images/coffee_maker.png" /></a>
</center></p>
<pre><code class="cpp">                      No Dependency injection                 | Dependency Injection
                      ----------------------------------------|-------------------------------------------
                      class coffee_maker {                    | class coffee_maker {
                      public:                                 | public:
                          void brew() {                       |   coffee_maker(const shared_ptr&lt;iheater&gt;&amp; heater
                              heater-&gt;on();                   |              , unique_ptr&lt;ipump&gt; pump)
                              pump-&gt;pump();                   |         : heater(heater), pump(move(pump))
                              clog &lt;&lt; &quot;coffee&quot;! &lt;&lt; endl;      |     { }
                              heater-&gt;off();                  |
                          }                                   |     void brew() {
                                                              |         heater-&gt;on();
                      private:                                |         pump-&gt;pump();
                          shared_ptr&lt;iheater&gt; heater =        |         clog &lt;&lt; &quot;coffee!&quot; &lt;&lt; endl;
                              make_shared&lt;electric_heater&gt;(); |         heater-&gt;off();
                                                              |     }
                          unique_ptr&lt;ipump&gt; pump =            |
                              make_unique&lt;heat_pump&gt;(heater); | private:
                      };                                      |     shared_ptr&lt;iheater&gt; heater;
                                                              |     unique_ptr&lt;ipump&gt; pump;
                                                              | };
</code></pre>

<h3 id="do-i-use-a-dependency-injection-already">Do I use a Dependency Injection already?</h3>
<ul>
<li>If you are using constructors in your code then you are probably using some form of Dependency Injection too!</li>
</ul>
<pre><code class="cpp">class Button {
 public:
  Button(const std::string&amp; name, Position position); // Dependency Injection!
};
</code></pre>

<h3 id="do-i-use-dependency-injection-correctly">Do I use Dependency Injection correctly?</h3>
<p>Common mistakes when using Dependency Injection are:</p>
<ul>
<li>
<p><strong>Passing a dependency to create another dependency inside your object</strong></p>
<p>It's a bad practice to pass dependencies to an object just in order
to create another one with those dependencies.
It's much cleaner to create the latter object beforehand and pass it to the former.</p>
</li>
</ul>
<pre><code class="cpp">class Model {
 public:
   Model(int width, int height)
     : board(std::make_unique&lt;Board&gt;(width, height)) // Bad
   { }

   explicit Model(std::unique_ptr&lt;IBoard&gt; board) // Better
     : board(std::move(board))
   { }

   ...

 private:
  std::unique_ptr&lt;IBoard&gt; board;
};
</code></pre>

<ul>
<li>
<p><strong>Carrying dependencies</strong></p>
<p>It's also important NOT to pass depenencies through layers of constructors (carrying them).
It's much better to always pass only dependecies which are required ONLY by the given constructor.</p>
</li>
</ul>
<pre><code class="cpp">class Model : public Service { // Bad
 public:
   explicit Model(std::unique_ptr&lt;IBoard&gt; board) // Bad
     : Service(std::move(board))
   { }

   void update() {
     Service::do_something_with_board(); // Bad
   }
};

class Model { // Better
 public:
   explicit Model(std::unique_ptr&lt;Service&gt; service) // Better
     : service(std::move(service))
   { }

   void update() {
     service-&gt;do_something_with_board(); // Better
   }

 private:
   std::unique_ptr&lt;Service&gt; service;
};
</code></pre>

<ul>
<li>
<p><strong>Carrying injector (Service Locator pattern)</strong></p>
<p>Service locator is consider to be an anti-pattern because its instance
is required to be passed as the ONLY constructor parameter into all
constructors. Such approach makes the code highly coupled to the Service Locator framework.
It's better to pass required dependencies direclty instead and use a DI framework to inject them.</p>
</li>
</ul>
<pre><code class="cpp">class Model {
 public:
   explicit Model(service_locator&amp; sl) // Bad (ask)
     : service(sl.resolve&lt;unique_ptr&lt;Service&gt;&gt;())
   { }

   explicit Model(std::unique_ptr&lt;Service&gt; service) // Better (tell)
     : service(std::move(service))
   { }

   ...

 private:
   std::unique_ptr&lt;Service&gt; service;
};
</code></pre>

<ul>
<li>
<p><strong>Not using strong typedefs for constructor parameters</strong></p>
<p>Being explicit and declarative is always better than being impilicit.
Using common types (ex. numbers) in order to define any common-like type may cause
missusage of the constructor interface. Using <code>strong typedefs</code> is easier to follow and
protects against missusage of the constructor interface.</p>
</li>
</ul>
<pre><code class="cpp">class Board {
 public:
   Board(int /*width*/, int /*height*/)  // Bad; Board{2, 3} vs Board{3, 2}?

   Board(width, height) // Better, explicit; Board{width{2}, height{3}};

   ...
};
</code></pre>

<h3 id="do-i-need-a-dependency-injection">Do I need a Dependency Injection?</h3>
<ul>
<li>DI provides loosely coupled code (separation of business logic and object creation)</li>
<li>DI provides easier to maintain code (different objects might be easily injected)</li>
<li>DI provides easier to test code (fakes objects might be injected)</li>
</ul>
<h4 id="stupid-vs-solid-clean-code-uncle-bob">STUPID vs SOLID - "Clean Code" Uncle Bob</h4>
<table>
  <tr><td><b>S</b></td><td>Singleton</td></tr>
  <tr><td><b>T</b></td><td>Tight Coupling</td></tr>
  <tr><td><b>U</b></td><td>Untestability</td></tr>
  <tr><td><b>P</b></td><td>Premature Optimization</td></tr>
  <tr><td><b>I</b></td><td>Indescriptive Naming</td></tr>
  <tr><td><b>D</b></td><td>Duplication</td></tr>
</table>

<blockquote>
<p>vs</p>
</blockquote>
<table>
  <tr><td><b>S</b></td><td><b>Single Responsibility</b></td></tr>
  <tr><td><b>O</b></td><td>Open-close</td></tr>
  <tr><td><b>L</b></td><td>Liskov substitution</td></tr>
  <tr><td><b>I</b></td><td>Interface segregation</td></tr>
  <tr><td><b>D</b></td><td><b>Dependency inversion</b></td></tr>
</table>

<h3 id="do-i-need-a-di-frameworklibrary">Do I need a DI Framework/Library?</h3>
<p>Depending on a project and its scale you may put up with or without a DI library, however, in any project
a DI framework may <strong>free you</strong> from maintaining a following (boilerplate) code...</p>
<pre><code class="cpp">logger logger_;
renderer renderer_;
view view_{renderer_, logger_};
model model_{logger_};
controller controller_{model_, view_, logger_};
user user_{logger_};
app app_{controller_, user_};
</code></pre>

<p>Notice that <strong>ORDER</strong> in which above dependencies are created is <strong>IMPORTANT</strong> as well as that
<strong>ANY</strong> change in <strong>ANY</strong> of the objects constructor will <strong>REQUIRE</strong> a change in this code!</p>
<h4 id="manual-di-wiring-mess-avoid-it-by-using-boostdi">Manual DI - Wiring Mess (Avoid it by using [Boost].DI)</h4>
<pre><code>* Single Responsibility Principle
  =&gt;
    * A lot of classes
    =&gt;
      * Wiring Mess
      =&gt;
        * Hard to maintain + Lazy programmers (99%)
        =&gt;
          * Hacks/Workarounds (~~Single Responsibility~~)
</code></pre>

<ul>
<li><a href="https://raw.githubusercontent.com/boost-experimental/di/cpp14/example/motivation.cpp"> Motivation Example</a>
<br /></li>
</ul>
<p>Right now, imagine a project with hundreds or thousands of those dependencies and a critical issue
which has to be fixed ASAP. Unfortunately, in order to fix the bug properly a new non-trivial dependency has to be
introduced.</p>
<p>Now, imagine that a 'smart' dev figured out that it will be much easier to extend the functionally
of already passed object and sneak a workaround/'solution' this way. Such approach will possibly break the <strong><a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility principle</a></strong>
of the changed object but no worries though, it might be refactored later on (meaning: most likely, the workaround will stay unchanged forever and that there are no tests).</p>
<p><strong>If that sounds familiar</strong>, take a look into DI library as it helps to solve developer dilemma by taking care
of creating all required dependencies whereas dev may focus on fixing and testing the issue.</p>
<hr />
<p><strong>DI library</strong>, not only let you forget about maintaining dependencies creation (See <a href="tutorial/index.html#1-basic-create-objects-tree">Create Objects Tree</a>),
but also can help you with...</p>
<ul>
<li>Testing (See <a href="extensions/index.html#mocks-provider">Mocks Provider</a>)</li>
<li>Serializing (See <a href="extensions/index.html#serialize">Serialize</a>)</li>
<li>Understand code dependencies (See <a href="extensions/index.html#uml-dumper">UML Dumper</a>)</li>
<li>Restrict what types and how they should be created (See <a href="user_guide/index.html#di_constructible">Constructible Policy</a>)</li>
</ul>
<h3 id="real-life-examples">Real Life examples?</h3>
<ul>
<li><a href="https://github.com/modern-cpp-examples/match3">Match-3 Game</a><ul>
<li>Simple web game in C++14 using SDL2 / Model View Controller / Meta State Machine / Dependency Injection / Range-V3 / Emscripten<ul>
<li><a href="http://modern-cpp-examples.github.io/match3">Play it online!</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote></blockquote>
<ul>
<li><a href="https://github.com/krzysztof-jusiak/mocks_injector">Automatic Mocks Injector</a><ul>
<li>Automatically create and inject required mocks to tested classes via constructors</li>
</ul>
</li>
</ul>
<blockquote></blockquote>
<ul>
<li><a href="http://boost-experimental.github.io/sml">Experimental Boost.SML</a><ul>
<li>C++14 header only Meta State Machine library with no dependencies</li>
</ul>
</li>
</ul>
<h3 id="why-boostdi">Why [Boost].DI?</h3>
<ul>
<li>[Boost].DI has none run-time overhead (See <a href="overview/index.html#performance">Performance</a>)</li>
<li>[Boost].DI compiles fast / <strong>Faster than Java-<a href="https://github.com/google/dagger">Dagger2</a>!</strong> (See <a href="overview/index.html#benchmarks">Benchmarks</a>)</li>
<li>[Boost].DI gives short diagnostic messages (See <a href="overview/index.html#error-messages">Error messages</a>)</li>
<li>[Boost].DI is non-intrusive (See <a href="user_guide/index.html#injections">Injections</a>)</li>
<li>[Boost].DI reduces boilerplate code (See <a href="tutorial/index.html#1-basic-create-objects-tree">Create Objects Tree</a>)</li>
<li>[Boost].DI reduces testing effort (See <a href="extensions/index.html#mocks-provider">Mocks Provider</a>)</li>
<li>[Boost].DI gives better control of what and how is created (See <a href="user_guide/index.html#di_constructible">Constructible Policy</a>)</li>
<li>[Boost].DI gives better understanding about objects hierarchy (See <a href="extensions/index.html#uml-dumper">UML Dumper</a>)</li>
</ul>
<blockquote>
<p><a href="http://boost-experimental.github.io/di/try_it/index.html"><strong>Try it online!</strong></a></p>
</blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/boost-experimental/di/cpp14/extension/test/policies/uml_dumper.cpp"> UML Dumper Extension</a></li>
<li><a href="https://raw.githubusercontent.com/boost-experimental/di/cpp14/extension/test/injections/xml_injection.cpp"> XML Injection Extension</a></li>
<li><a href="https://raw.githubusercontent.com/boost-experimental/di/cpp14/example/user_guide/policies_constructible_local.cpp"> Constructible Example</a></li>
</ul>
<p><br /><br /></p>
<h3 id="boostdi-design-goals">[Boost].DI design goals</h3>
<ul>
<li>Be as fast as possible (See <a href="overview/index.html#performance">Performance</a>)</li>
<li>Compile as fast as possible (See <a href="overview/index.html#benchmarks">Benchmarks</a>)</li>
<li>Give short and intuitive error messages (See <a href="overview/index.html#error-messages">Error messages</a>)</li>
<li>Guarantee object creation at compile-time (See <a href="tutorial/index.html#1-basic-create-objects-tree">Create Objects Tree</a>)</li>
<li>Be as non-intrusive as possible (See <a href="user_guide/index.html#injections">Injections</a>)</li>
<li>Be easy to extend (See <a href="extensions/index.html">Extensions</a>)</li>
</ul>
<h3 id="articles">Articles</h3>
<ul>
<li><a href="http://martinfowler.com/articles/injection.html">Inversion of Control Containers and the Dependency Injection pattern</a></li>
<li><a href="http://martinfowler.com/articles/dipInTheWild.html">DIP in the Wild</a></li>
<li><a href="http://boost-experimental.github.io/di/concepts-driven-design-with-di">Concepts driven design with Dependency Injection</a></li>
</ul>
<h3 id="videos">Videos</h3>
<h4 id="boostdi">[Boost].DI</h4>
<ul>
<li><a href="https://www.youtube.com/watch?v=8HmjM3G8jhQ">CppCon 2018: [Boost].DI - Inject all the things!</a> | <a href="https://boost-experimental.github.io/di/cppcon-2018">Slides</a></li>
<li><a href="https://www.youtube.com/watch?v=comZthFv3PM">C++Now 2016: C++14 Dependency Injection Library</a> | <a href="http://boost-experimental.github.io/di/cppnow-2016">Slides</a></li>
<li><a href="https://www.youtube.com/watch?v=T3uMcxhzRUE">Meeting C++ 2016: TDD/BDD and Dependency Injection</a> | <a href="http://boost-experimental.github.io/di/meetingcpp-2016">Slides</a></li>
<li><a href="https://skillsmatter.com/skillscasts/9830-boost-your-design-with-c-plus-plus14-dependency-injection">Boost your design with C++14 dependency injection</a> | <a href="http://boost-experimental.github.io/di/cpp-london-2017">Slides</a></li>
</ul>
<h4 id="dependency-injection-in-general">Dependency Injection In General</h4>
<ul>
<li><a href="https://www.youtube.com/watch?v=IKD2-MAkXyQ">Dependency Injection</a></li>
<li><a href="https://www.youtube.com/watch?v=RlfLCWKxHJ0">The Clean Code Talks - Don't Look For Things!</a></li>
<li><a href="http://www.youtube.com/watch?v=oK_XtfXPkqw">A New Type of dependency injection</a></li>
<li><a href="https://www.youtube.com/watch?v=plK0zyRLIP8">The Future of Dependency Injection with Dagger 2</a></li>
<li><a href="https://www.pluralsight.com/courses/design-patterns-cpp-creational">Design Patterns in C++: Creational</a></li>
</ul>
<h3 id="acknowledgements">Acknowledgements</h3>
<ul>
<li>Thanks to <strong>Bartosz Kalinczuk</strong> for code review and tips how to improve <code>[Boost].DI</code></li>
<li>Thanks to <strong>Kanstantsin Chernik</strong> for all his contributions to <code>[Boost].DI</code></li>
<li>Thanks to <strong>Olof Edlund</strong> for very useful feedback and for all the improvements to the documentation</li>
<li>Thanks to <strong>Rob Stewart</strong> and <strong>Robert Ramey</strong> for documentation feedback and tips how to improve it</li>
<li>Thanks to <strong>Sohail Somani</strong> for support and tips how to improve <code>[Boost].DI</code></li>
</ul>
</div>

<script src="./js/highlight.pack.js"></script>

<script>
hljs.configure({languages:['cpp']});
hljs.initHighlightingOnLoad();
</script>

<div class="copyright-footer">Copyright &copy; 2012-2018 Kris Jusiak (kris at jusiak net)
      <p>Distributed under the Boost Software License, Version 1.0.
      (See accompanying file <code class="filename">LICENSE_1_0.txt</code> or copy at
      <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div>

</div>

<hr>
<div class="spirit-nav">
<a accesskey="p"  ><img src="./images/prev.png" alt="Prev"></a><a accesskey="u" href="index.html"><img src="./images/up.png" alt="Up"></a><a accesskey="h" href="index.html"><img src="./images/home.png" alt="Home"></a><a accesskey="n"  href="overview/index.html"><img src="./images/next.png" alt="Next"></a>
</div>

<script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>
<select onChange="window.location.href=this.value" style="position: absolute; top: 20px; right: 30px; z-index: 10;">
    <option value="https://boost-experimental.github.io/di">Theme: Boost Experimental</option>
    <option value="https://boost-experimental.github.io/di/boost" selected>Theme: Boost Classic</option>
</select>
</body>
</html>